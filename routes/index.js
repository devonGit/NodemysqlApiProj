var express = require('express');var passport = require('passport');var router = express.Router();var mysql = require('mysql');var dbquerymodule = require('./../config/dbQuerymodule.js');var multer = require('multer');var connection = mysql.createConnection({	host:'localhost',	user:'root',	password:'root'});//connection.query('use auth');connection.query('use authapi');var Storage = multer.diskStorage({	destination: function (req, file, callback) {		//callback(null, "../../images");		callback(null, "./images");	},	filename: function (req, file, callback) {		callback(null, file.fieldname + "_" + Date.now() + "_" + file.originalname);	}});var upload = multer({ storage: Storage }).single('imgUploader');/* GET home page. */router.get('/', function(req, res, next) {  res.render('index', { title: 'Authentication' });});router.get('/login', function(req, res, next){	res.render('login.ejs', {		message:req.flash('loginMessage')	});});router.get('/signup', function(req, res){	res.render('signup.ejs', {		message:req.flash('signupMessage')	});});router.get('/profile', function(req, res){	//var userid=req.user.email;var xy='';	/*dbquerymodule.urlauth(userid,function(a){		console.log('The Call back value is ---------->'+ a);		res.contentType('application/json').status(200);		var r=dbquerymodule.getulrdata(req,res,userid);		var dev={"x":r,"y":a};		xy=a;		res.send(dev);	});*/	/*var dev=dbquerymodule.urlauth(userid,function(callback){		console.log('The Call back value is ---------->'+ callback);		//res.contentType('application/json').status(200);		//var r=dbquerymodule.getulrdata(req,res,userid);		//var dev={"x":r,"y":callback};		xy=callback;		console.log('bbbbbbbbbbb'+xy);		//res.send(dev);		return xy;	});	console.log('bbbbbbbbbbbbbbbbbbb xyxyxyxyyxy-->'+dev);*/	/*var urldta1=dbquerymodule.getulrdata(req,res,userid);	/!*console.log("the Req- mail-->"+req.user.email);*!/	//console.log('the url module is -->'+JSON.stringify(urldta));	console.log('the url module 11is -->'+JSON.stringify(urldta1));	console.log('the Url is  -->'+req.url);*/	res.render('profile.ejs', {		user:req.user	});});router.post('/uploadFile',function(req,res){//var upload = multer({ storage: Storage }).array("imgUploader", 3);	upload(req, res, function(err) {		if(err){			console.log(err);			res.end('The Error is ---'+err);		}else{			//res.end('File is uploaded')			res.render('successMsg.ejs', {				successmsg:'The File uploaded Successfully'			});		}	});	});router.get('/logout', function(req, res){	req.logout();	res.redirect('/');});router.post('/signup', passport.authenticate('local-signup',{	successRedirect:'/profile',	failureRedirect:'/signup',	failureFlash:true}));router.post('/login', passport.authenticate('local-login',{	successRedirect:'/profile',	failureRedirect:'/login',	failureFlash:true,	session:true}));module.exports = router;function isLoggedIn(req,res,next) {	if(req.isAuthenticated())		return next();	res.redirect('/');}